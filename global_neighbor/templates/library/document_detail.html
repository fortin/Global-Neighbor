{% extends "base.html" %}
{% block title %}{{ document.title }}{% endblock %}

{% block content %}
<div class="document-detail-container">
  <h1 class="page-title">{{ document.title }}</h1>

  <p class="doc-meta">
    {% if document.author %}<strong>Author:</strong> {{ document.author }}<br>{% endif %}
    {% if document.source %}<strong>Source:</strong> {{ document.source }}<br>{% endif %}
    <strong>Uploaded by:</strong> {{ document.uploaded_by }}<br>
    <strong>Downloads:</strong> {{ document.download_count }}
  </p>

  <div class="document-actions" style="margin-top: 1.5rem; margin-bottom: 1.5rem;">
    {# Download: neighbor/creator/moderator OR superuser (must be authenticated) #}
    {% if request.user.is_authenticated and request.user.is_superuser
          or request.user.is_authenticated and request.user.role == 'neighbor'
          or request.user.is_authenticated and request.user.role == 'creator'
          or request.user.is_authenticated and request.user.role == 'moderator' %}
      <a href="{% url 'download_document' document.id %}" class="btn btn-primary">
        <i class="fa fa-download"></i> Download
      </a>
    {% else %}
      {# Optional: show a login button if not allowed #}
      <a href="{% url 'login' %}?next={{ request.path|urlencode }}" class="btn btn-secondary">
        <i class="fa fa-sign-in-alt"></i> Log in to download
      </a>
    {% endif %}

    {# Edit/Delete: uploader OR superuser (must be authenticated) #}
    {% if request.user.is_authenticated and request.user == document.uploaded_by
          or request.user.is_authenticated and request.user.is_superuser %}
      <a href="{% url 'edit_document' document.id %}" class="btn btn-secondary">
        <i class="fa fa-pen"></i> Edit
      </a>
      <a href="{% url 'delete_document' document.id %}" class="btn btn-secondary">
        <i class="fa fa-trash"></i> Delete
      </a>
    {% endif %}
  </div>

  <div class="pdf-viewer">
    <iframe src="{% url 'serve_document' document.id %}" width="100%" height="700px" style="border: none;">
      This browser does not support PDFs. Please download the PDF to view it:
      <a href="{% url 'serve_document' document.id %}">Download PDF</a>
    </iframe>
  </div>

</div>
{% endblock %}